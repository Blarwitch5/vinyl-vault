---
export interface Props {
  id?: string
  title?: string
  size?: 'sm' | 'md' | 'lg' | 'xl'
  class?: string
}

const { id = 'modal', title = '', size = 'md', class: className = '', ...rest } = Astro.props

// Tailles
const sizes = {
  sm: 'max-w-md',
  md: 'max-w-lg',
  lg: 'max-w-2xl',
  xl: 'max-w-4xl',
}

const modalClasses = `${sizes[size]} ${className}`
---

<div
  {id}
  class="fixed inset-0 bg-black/70 backdrop-blur-sm items-center justify-center z-50 hidden overflow-y-auto"
  aria-labelledby="modal-title"
  role="dialog"
  aria-modal="true"
>
  <div
    class={`relative w-full ${modalClasses} transform overflow-hidden rounded-2xl bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-700 shadow-2xl transition-all mx-4`}
    {...rest}
  >
    <!-- Header -->
    {
      title && (
        <div class="px-6 py-4 border-b border-neutral-200 dark:border-neutral-800">
          <h3 id="modal-title" class="text-lg font-semibold text-neutral-900 dark:text-neutral-50">
            {title}
          </h3>
        </div>
      )
    }

    <!-- Content -->
    <div class="px-6 py-4">
      <slot />
    </div>

    <!-- Footer -->
    <div class="px-6 py-4 border-t border-neutral-200 dark:border-neutral-800">
      <slot name="footer" />
    </div>
  </div>
</div>

<script>
  // Fonctions d'animation pour le modal générique
  function openModal(modalId: string) {
    const modal = document.getElementById(modalId)
    if (!modal) return

    document.body.style.overflow = 'hidden'
    modal.style.opacity = '0'
    modal.classList.remove('hidden')
    modal.classList.add('flex')

    setTimeout(() => {
      modal.style.transition = 'opacity 250ms ease-out'
      modal.style.opacity = '1'
    }, 10)
  }

  function closeModal(modalId: string) {
    const modal = document.getElementById(modalId)
    if (!modal) return

    modal.style.transition = 'opacity 200ms ease-in'
    modal.style.opacity = '0'

    setTimeout(() => {
      modal.classList.add('hidden')
      modal.classList.remove('flex')
      modal.style.transition = ''
      modal.style.opacity = ''
      document.body.style.overflow = ''
    }, 200)
  }

  // Exposer les fonctions globalement
  ;(window as any).openModal = openModal
  ;(window as any).closeModal = closeModal
</script>
